
; dacomitinib model parameters from: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7238139/
; transit cmt code from:
; Modified from appendix 4 of Jun Shen, Alison Boeckmann & Andrew Vick
; Modified for NONMEM 7.3
; Journal of Pharmacokinetics and Pharmacodynamics
; ISSN 1567-567X Volume 39 Number 3
; J Pharmacokinet Pharmacodyn (2012) 39:251-262 DOI 10.1007/s10928-012-9247-3
$SIZES LVR=2000 LTH=2000
$PROBLEM dacomitinib transit  cmt model
$INPUT ID  TIME  EVID   CMT     DV   AMT  RATE   MDV   PPI
$DATA /data/sandbox/trunk/analysis/NMsim/wdirs/NMsim/devel/example_nonmem_models/dacomitinib_sim_data.csv IGNORE=@  
$SUBROUTINES ADVAN13 TOL=5

$MODEL COMP=ABS ;(DEFDOSE)
       COMP=CENTRAL;(DEFOBS)
       COMP=PERI

$abbr declare dosetime(100),dose(100)
$abbr declare dowhile i
$abbr declare dowhile ndose

$PK 
; for transit model
CALLFL=-2
IF (NEWIND < 2) NDOSE=0

IF (AMT > 0 .and. cmt==1) THEN
 NDOSE=NDOSE+1
 dosetime(NDOSE)=TIME
 DOSE(NDOSE)=AMT
ENDIF

; covariates

PPIF1 = 1
IF(PPI.EQ.1) PPIF1 = (1 + THETA(9))
PPIKA = 1
IF(PPI.EQ.1) PPIKA = (1 + THETA(10))

CL  = THETA(1)*EXP(ETA(1))
V   = THETA(2)*EXP(ETA(2))
Q   = THETA(3)*EXP(ETA(3))
VSS = THETA(4)*EXP(ETA(4))

K = CL/V
S2 = V
K23 = Q/V
K32 = Q/(VSS-V)

;From NONMEM guide: 
;K=CL/V
;K23=Q/V
;K32=Q/(VSS-V)
;KA=KA

;--------ABSORPTION MODEL-----------
F1=0
MTT  = THETA(5)*EXP(ETA(5))
NN   = THETA(6)
KA   = THETA(7)*PPIKA*EXP(ETA(6))
BIO  = THETA(8)*PPIF1*EXP(ETA(7))
KTR  = (NN+1)/MTT

;NFAC=SQRT(2*3.1416)*NN**(NN+0.5)*(EXP(-NN))*(1+1/(12*NN))
NFAC=EXP(GAMLN(NN+1))
KINPT=BIO*KTR**(NN+1)/NFAC

DUMMY=THETA(11)+THETA(12)+THETA(13)+THETA(14)+THETA(15)+THETA(16)+THETA(17)+THETA(18)+THETA(19)+THETA(20)+THETA(21)+THETA(22)+THETA(23)+THETA(24)+THETA(25)+THETA(26)+THETA(27)+THETA(28)+THETA(29)+THETA(30)+THETA(31)+THETA(32)+THETA(33)+THETA(34)+THETA(35)+THETA(36)+THETA(37)

$DES
INPT=0
I=1
DOWHILE (I<=NDOSE)
IPT=0
IF (T>=dosetime(I)) IPT=DOSE(I)*(T-dosetime(I))**NN*EXP(-KTR*(T-dosetime(I)))
INPT=INPT+IPT
I=I+1
ENDDO

 DADT(1)=KINPT*INPT-KA*A(1)
; DADT(2)=KTR*A(1)-K23*A(2)-K*A(2)+K32*A(3)
 DADT(2)=KA*A(1)-K23*A(2)-K*A(2)+K32*A(3)
 DADT(3)=K23*A(2)-K32*A(3)

$ERROR
A1 = A(1)
A2 = A(2)
A3 = A(3)
IPRED=F
Y = F*EXP(EPS(1))


;-----------------------INITIAL ESTIMATES---------------------------------
THETA1 = THETA(1)
THETA2 = THETA(2)
THETA3 = THETA(3)
THETA4 = THETA(4)
THETA5 = THETA(5)
THETA6 = THETA(6)
THETA7 = THETA(7)
THETA8 = THETA(8)
THETA9 = THETA(9)
THETA10 = THETA(10)
THETA11 = THETA(11)
THETA12 = THETA(12)
THETA13 = THETA(13)
THETA14 = THETA(14)
THETA15 = THETA(15)
THETA16 = THETA(16)
THETA17 = THETA(17)
THETA18 = THETA(18)
THETA19 = THETA(19)
THETA20 = THETA(20)
THETA21 = THETA(21)
THETA22 = THETA(22)
THETA23 = THETA(23)
THETA24 = THETA(24)
THETA25 = THETA(25)
THETA26 = THETA(26)
THETA27 = THETA(27)
THETA28 = THETA(28)
THETA29 = THETA(29)
THETA30 = THETA(30)
THETA31 = THETA(31)
THETA32 = THETA(32)
THETA33 = THETA(33)
THETA34 = THETA(34)
THETA35 = THETA(35)
THETA36 = THETA(36)
THETA37 = THETA(37)

OMEGA1_1 = OMEGA(1,1)
OMEGA2_1 = OMEGA(2,1)
OMEGA2_2 = OMEGA(2,2)
OMEGA3_1 = OMEGA(3,1)
OMEGA3_2 = OMEGA(3,2)
OMEGA3_3 = OMEGA(3,3)
OMEGA4_1 = OMEGA(4,1)
OMEGA4_2 = OMEGA(4,2)
OMEGA4_3 = OMEGA(4,3)
OMEGA4_4 = OMEGA(4,4)
OMEGA5_1 = OMEGA(5,1)
OMEGA5_2 = OMEGA(5,2)
OMEGA5_3 = OMEGA(5,3)
OMEGA5_4 = OMEGA(5,4)
OMEGA5_5 = OMEGA(5,5)
OMEGA6_1 = OMEGA(6,1)
OMEGA6_2 = OMEGA(6,2)
OMEGA6_3 = OMEGA(6,3)
OMEGA6_4 = OMEGA(6,4)
OMEGA6_5 = OMEGA(6,5)
OMEGA6_6 = OMEGA(6,6)
OMEGA7_1 = OMEGA(7,1)
OMEGA7_2 = OMEGA(7,2)
OMEGA7_3 = OMEGA(7,3)
OMEGA7_4 = OMEGA(7,4)
OMEGA7_5 = OMEGA(7,5)
OMEGA7_6 = OMEGA(7,6)
OMEGA7_7 = OMEGA(7,7)

SIGMA1_1 = SIGMA(1,1)



$THETA 
29.893  ; 1 CL
789.75  ; 2 V
76.8 FIX   ; 3 Q
2276    ; 4 VSS
12.03   ; 5 MTT
1       ; 6 NN
0.259 FIX  ; 7 KA
1       ; 8 BIO
-0.524  ; 9 PPI on KA
-0.487  ; 10 PPI on F1
0 FIX   ; 11
0 FIX   ; 12
1.0 FIX ; 13
0 FIX   ; 14
0 FIX   ; 15
0 FIX   ; 16
1.0 FIX ; 17
0 FIX   ; 18
0 FIX   ; 19
0 FIX   ; 20
1.0 FIX ; 21
1.0 FIX ; 22
1.0 FIX ; 23
1.0 FIX ; 24
1.0 FIX ; 25
1.0 FIX ; 26
1.0 FIX ; 27
1.0 FIX ; 28
1.0 FIX ; 29
1.0 FIX ; 30
1.0 FIX ; 31
1.0 FIX ; 32
1.0 FIX ; 33
1.0 FIX ; 34
1.0 FIX ; 35
1.0 FIX ; 36
1.0 FIX ; 37

$OMEGA BLOCK(2)
0.03413256  ; 1 ; CL
0.01       0.04        ; 2 ; V
$OMEGA 0.02499877  ; 3 ; Q
$OMEGA 0.02499877  ; 4 ; Vss
$OMEGA BLOCK(2) 
0.02499877  ; 5 ; MTT
0.01   0.3014449   ; 6 ; Ka
$OMEGA 0.05417256 FIX ; 7 ; F1 (BIO)

$SIGMA 0.289


$PRIOR NWPRI PLEV=0.999000


$THETAP
29.893  FIX ; 1 CL
789.75  FIX ; 2 V
76.8    FIX ; 3 Q
2276    FIX ; 4 VSS
12.03   FIX ; 5 MTT
1       FIX ; 6 NN
0.259   FIX ; 7 KA
1       FIX ; 8 BIO
-0.524  FIX ; 9 PPI on KA
-0.487  FIX ; 10 PPI on F1
0 FIX   ; 11
0 FIX   ; 12
1.0 FIX ; 13
0 FIX   ; 14
0 FIX   ; 15
0 FIX   ; 16
1.0 FIX ; 17
0 FIX   ; 18
0 FIX   ; 19
0 FIX   ; 20
1.0 FIX ; 21
1.0 FIX ; 22
1.0 FIX ; 23
1.0 FIX ; 24
1.0 FIX ; 25
1.0 FIX ; 26
1.0 FIX ; 27
1.0 FIX ; 28
1.0 FIX ; 29
1.0 FIX ; 30
1.0 FIX ; 31
1.0 FIX ; 32
1.0 FIX ; 33
1.0 FIX ; 34
1.0 FIX ; 35
1.0 FIX ; 36
1.0 FIX ; 37

$THETAPV BLOCK(37) FIX
0.1 ; 1
0.01 0.1  ; 2
1e-20 1e-20 1.0  ; 3
0.01 0.01 1e-20 0.1  ; 4
0.01 0.01 1e-20 0.01 0.1  ; 5
0.01 0.01 1e-20 0.01 0.01 0.1  ; 6
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 7
0.01 0.01 1e-20 0.01 0.01 0.01 1e-20 0.1  ; 8
0.01 0.01 1e-20 0.01 0.01 0.01 1e-20 0.01 0.1  ; 9
0.01 0.01 1e-20 0.01 0.01 0.01 1e-20 0.01 0.01 0.1  ; 10
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 11
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 12
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 13
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 14
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 15
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 16
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 17
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 18
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 19
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 20
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 21
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 22
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 23
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 24
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 25
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 26
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 27
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 28
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 29
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 30
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 31
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 32
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 33
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 34
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 35
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 36
1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1e-20 1.0 ; 37

$OMEGAP BLOCK(2) FIX
0.03413256  ; 1 ; CL
0.01       0.04        ; 2 ; V
$OMEGAP 0.02499877 FIX  ; 3 ; Q
$OMEGAP 0.02499877  FIX ; 4 ; Vss
$OMEGAP BLOCK(2) FIX 
0.02499877  ; 5 ; MTT
0.01   0.3014449   ; 6 ; Ka
$OMEGAP 0.05417256 FIX ; 7 ; F1 (BIO)

$OMEGAPD 50.0 FIX ; 1-2
$OMEGAPD 80.0 FIX ; 3
$OMEGAPD 50.0 FIX ; 4
$OMEGAPD 50.0 FIX ; 5-6
$OMEGAPD 1 FIX ; 7, fixed.

$SIGMAP 0.289 FIX
$SIGMAPD 400 FIX


$SIMULATION ONLYSIM (706344515) TRUE=PRIOR SUBPROBLEMS=250 

$TABLE PRED IPRED Y THETA1 THETA2 THETA3 THETA4 THETA5 THETA6 THETA7 THETA8 THETA9 THETA10 THETA11 THETA12 THETA13 THETA14 THETA15 THETA16 THETA17 THETA18 THETA19 THETA20 THETA21 THETA22 THETA23 THETA24 THETA25 THETA26 THETA27 THETA28 THETA29 THETA30 THETA31 THETA32 THETA33 THETA34 THETA35 THETA36 THETA37 OMEGA1_1 OMEGA2_1 OMEGA2_2 OMEGA3_1 OMEGA3_2 OMEGA3_3 OMEGA4_1 OMEGA4_2 OMEGA4_3 OMEGA4_4 OMEGA5_1 OMEGA5_2 OMEGA5_3 OMEGA5_4 OMEGA5_5 OMEGA6_1 OMEGA6_2 OMEGA6_3 OMEGA6_4 OMEGA6_5 OMEGA6_6 OMEGA7_1 OMEGA7_2 OMEGA7_3 OMEGA7_4 OMEGA7_5 OMEGA7_6 OMEGA7_7 SIGMA1_1 NOPRINT NOAPPEND  FILE=mod_dacomitinib_transit_iiv_testing_NWPRI.tab

