; model from: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7894400/
$PROBLEM    lorlatinib 2-cmt analytical w/ autoinduction
$INPUT ID TIME EVID CMT AMT II ADDL RATE DV MDV BALB BWT DOSCUMA DOSCUMN PDOSAMT PPI REC ROUT SD TAPD TDOSE TPDOS WNCL

$DATA ./NMsimData_mod_lorlatinib_estimate_NWPRI.csv
IGN=@

$SUBROUTINE ADVAN4 TRANS4
$PK

;covariates
; typical: BWT=70; PPI=0; WNCL=100; BALB=4; TDOSE=100; PPI=0
IF(PPI.EQ.0) KAPPI = 1  ; Most common
IF(PPI.EQ.1) KAPPI = ( 1 + THETA(15))
KACOV=KAPPI
CLWNCL = ((WNCL/100.00)**THETA(14))
CLTDOSE = ( 1 + THETA(13)*(TDOSE - 100.00))
CLBALB = ( 1 + THETA(12)*(BALB - 4.00))
CLCOV=CLBALB*CLTDOSE*CLWNCL

; model

TVCLI = THETA(1) * ((BWT / 70) ** 0.75)
TVV2 = THETA(2) * (BWT / 70)

TVKA = THETA(3)
TVKA = KACOV * TVKA

TVQ = THETA(4)
TVV3 = THETA(5)
TVIN = THETA(6)
TVD1 = THETA(7)
TVF1 = THETA(8)
TVCLMX = THETA(9) * ((BWT / 70) ** 0.75)


V2 =  TVV2 * EXP(ETA(3))
KA = EXP(TVKA + ETA(5))
Q = TVQ
V3 = TVV3 * EXP(ETA(4))
IND = TVIN
D1 = TVD1
F1 = TVF1 * EXP(ETA(2))
TVCL = TVCLI
IF(SD.NE.1) TVCL = TVCLMX * (1 - EXP(-IND * (TIME+0.0001)))

TVCL = CLCOV * TVCL
CL = TVCL * EXP(ETA(1))

S2 = V2 / 1000

$ERROR 
IPRD=F
IF(IPRD.LE.0)IPRD=0.0001
IPRED=LOG(IPRD)
IRES=DV-IPRED

IF(ROUT.EQ.28) THEN
W= SQRT(THETA(10)**2)
ELSE
W= SQRT(THETA(11)**2)
ENDIF

IWRES=IRES/W
Y = IPRED+W*ERR(1)


THETA1 = THETA(1)
THETA2 = THETA(2)
THETA3 = THETA(3)
THETA4 = THETA(4)
THETA5 = THETA(5)
THETA6 = THETA(6)
THETA7 = THETA(7)
THETA8 = THETA(8)
THETA9 = THETA(9)
THETA10 = THETA(10)
THETA11 = THETA(11)
THETA12 = THETA(12)
THETA13 = THETA(13)
THETA14 = THETA(14)
THETA15 = THETA(15)
OMEGA1_1 = OMEGA(1,1)
OMEGA2_1 = OMEGA(2,1)
OMEGA2_2 = OMEGA(2,2)
OMEGA3_1 = OMEGA(3,1)
OMEGA3_2 = OMEGA(3,2)
OMEGA3_3 = OMEGA(3,3)
OMEGA4_1 = OMEGA(4,1)
OMEGA4_2 = OMEGA(4,2)
OMEGA4_3 = OMEGA(4,3)
OMEGA4_4 = OMEGA(4,4)
OMEGA5_1 = OMEGA(5,1)
OMEGA5_2 = OMEGA(5,2)
OMEGA5_3 = OMEGA(5,3)
OMEGA5_4 = OMEGA(5,4)
OMEGA5_5 = OMEGA(5,5)
SIGMA1_1 = SIGMA(1,1)

$THETA  (0,9.46098) ; CLI
 (0,120.562) ; V2
 0.83429 ; KA
 (0,22.0079) ; Q
 (0,153.977) ; V3
 (0,0.0199883) ; IND
 (0,1.1507) ; D1
 (0,0.827505,1) ; F1
 14.5443 ; CLMX
 0.000280002 ; prop error for IV
 0.00274687 ; prop error for PO
 0.0705631 ; CLBALB1
 0.00138 FIX ; CLTDOSE1; TDOSE,total daily lorlatinib dose
 0.10094 ; CLWNCL1; WNCL,baseline standardized creatinine clearance
 0.405724 ; KAPPI1
$OMEGA  BLOCK(2)
 0.0256425  ;         CL
 0.00284632 0.0102378  ;        F1_
$OMEGA  BLOCK(2)
 0.0749815  ;        V2_
 0.0268885 0.0692446  ;        V3_
$OMEGA  3.06443  ;        KA_
$SIGMA  1  FIX
;$SIMULATION (123456) ONLY
;$ESTIMATION METHOD=COND INTER MAXEVAL=9999 NOABORT NSIG=2 SIGL=6
;                PRINT=5 POSTHOC




$PRIOR NWPRI PLEV=0.999000
$THETAP
9.46098 FIX
120.562 FIX
0.83429 FIX
22.0079 FIX
153.977 FIX
0.0199883 FIX
1.1507 FIX
0.827505 FIX
14.5443 FIX
0.000280002 FIX
0.00274687 FIX
0.0705631 FIX
0.00138 FIX
0.10094 FIX
0.405724 FIX
$THETAPV BLOCK(15) FIX
6.53838e-06
-1.3267e-05 0.0014287
-1.58875e-06 -5.45941e-05 6.66482e-05
4.1439e-06 -0.000237115 1.18724e-05 6.38698e-05
0.000111975 -2.48273e-05 -0.000479304 -0.000252843 0.0377089
-6.13071e-09 1.04019e-07 -1.44652e-08 -1.3657e-10 4.95032e-07 1.4308e-10
-2.57355e-08 -1.29522e-05 8.59179e-06 4.2652e-06 -0.000126909 -4.5838e-10 4.35979e-06
-1.94549e-07 -9.53104e-06 -1.65609e-07 2.79449e-06 -2.99101e-05 2.49789e-09 5.6143e-07 1.50904e-06
4.50035e-06 -0.000189684 5.90145e-06 4.517e-05 -0.000141681 1.07326e-08 3.27978e-06 2.2954e-06 4.48561e-05
1.42478e-08 -6.66919e-08 -3.40312e-09 5.58898e-08 1.00055e-08 1.29488e-11 3.5178e-09 2.07445e-09 4.68285e-08 2.29227e-10
-5.85635e-09 1.62079e-07 -1.81256e-08 -3.28916e-08 2.74424e-06 2.27903e-10 -5.39302e-08 1.31012e-08 -6.79149e-09 -1.81787e-11 2.28669e-09
-3.77133e-07 -7.50573e-07 4.1474e-07 8.50699e-08 -2.37329e-05 -5.51665e-11 4.11966e-08 1.63725e-08 -1.26127e-07 -1.2204e-09 -8.82729e-10 5.83974e-08
1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30 1e-30
5.20449e-08 -8.47737e-07 6.07393e-07 3.8424e-08 -4.1797e-05 -2.89234e-09 7.72446e-08 -1.20933e-07 -3.15856e-07 1.06161e-09 -6.73944e-09 4.90991e-08 1e-30 5.09426e-07
-6.65426e-07 4.98656e-05 -7.85838e-05 8.00667e-07 -0.000175329 2.67036e-08 -1.2028e-06 1.80628e-06 5.36498e-06 1.25578e-08 -1.60544e-07 1.43943e-07 1e-30 -1.95036e-07 0.000338403
$OMEGAP BLOCK(2) FIX
0.0256425
0.00284632 0.0102378
$OMEGAP BLOCK(2) FIX
0.0749815
0.0268885 0.0692446
$OMEGAP 3.06443 FIX
$OMEGAPD 23.7407820406412 FIX
$OMEGAPD 33.2325829970469 FIX
$OMEGAPD 10.0137741879716 FIX
$SIGMAP 1 FIX
$SIGMAPD 1 FIX

$SIMULATION ONLYSIM (1301648525)
TRUE=PRIOR SUBPROBLEMS=250 

$TABLE PRED IPRED Y THETA1 THETA2 THETA3 THETA4 THETA5 THETA6 THETA7 THETA8 THETA9 THETA10 THETA11 THETA12 THETA13 THETA14 THETA15 OMEGA1_1 OMEGA2_1 OMEGA2_2 OMEGA3_1 OMEGA3_2 OMEGA3_3 OMEGA4_1 OMEGA4_2 OMEGA4_3 OMEGA4_4 OMEGA5_1 OMEGA5_2 OMEGA5_3 OMEGA5_4 OMEGA5_5 SIGMA1_1 NOPRINT NOAPPEND FILE=mod_lorlatinib_estimate_NWPRI.tab

