<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation-based forest plots with NMsim • NMsim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation-based forest plots with NMsim">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4.912</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/NMsim-intro.html">NMsim Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-VPC.html">Simulations for VPCs</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-config.html">Requirements and Configuration</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-known.html">Simulate Known Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-TypSubj.html">Simulate Typical Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ParamUncertain.html">Simulations with Parameter Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-DataCreate.html">Creation of Simulation Data Sets</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ResidVar.html">Simulation with Residual Variability</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-varyPars.html">Varying Parameter Values</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ReuseSimSubjects.html">Reuse Simulated Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/NMsim-publications.html">Publications</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation-based forest plots with NMsim</h1>
                        <h4 data-toc-skip class="author">Philip
Delff</h4>
                                    <h4 data-toc-skip class="author">Boris
Grinshpun</h4>
                        
            <h4 data-toc-skip class="date">November 12, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NMautoverse/NMsim/blob/main/vignettes/NMsim-forest.Rmd" class="external-link"><code>vignettes/NMsim-forest.Rmd</code></a></small>
      <div class="d-none name"><code>NMsim-forest.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The forest plot is an effective and widely recognized way to
illustrate estimated covariate effects on exposure or response, or
parameters related to these (e.g. clearance). The forest plot typically
includes precision of the estimate in terms of a confidence interval.
Often, an acceptance region such as the 80%-125% bio equivalence is
included for comparison.</p>
<p>In some cases, the forest plot can be derived based on model
estimates without simulation. This is the case for a forest plot on
exposure if the PK is linear and only steady-state average concentration
(or AUC) is of interest. If the PK is non-linear and/or exposure metrics
such as Cmax which depends on multiple PK parameters are of interest, a
simulation-based forest plot may be needed. As we shall see, NMsim
provides a flexible and concise framework to perform the required
simulations, a function for summarizing the simulation results is
provided, and it is demonstrated how the summary is easily plotted using
the coveffectsplot R package.</p>
<p>This vignette is no attempt to harmonize how to construct a forest
plot. Instead, we shall describe the steps taken, and it is up to the
scientist to choose how they want to construct the analysis to address
their questions most effectively.</p>
</div>
<div class="section level2">
<h2 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://NMautoverse.github.io/NMsim/">NMsim</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NMsim 0.1.4.912. Browse NMsim documentation at</span></span>
<span><span class="co">## https://nmautoverse.github.io/NMsim/</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nmautoverse.github.io/NMdata/" class="external-link">NMdata</a></span><span class="op">)</span>  </span></code></pre></div>
<pre><code><span><span class="co">## NMdata 0.1.8. Browse NMdata documentation at</span></span>
<span><span class="co">## https://nmautoverse.github.io/NMdata/</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">NMcalc</span><span class="op">)</span>  <span class="co">## Optional. Used to calculate AUC.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://smouksassi.github.io/coveffectsplot/" class="external-link">coveffectsplot</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Thank you for using coveffectsplot!</span></span>
<span><span class="co">## if you find it useful, please cite as:</span></span></code></pre>
<pre><code><span><span class="co">## JF Marier, N Teuscher and MS Mouksassi. Evaluation of covariate effects using forest plots and introduction to the coveffectsplot R package. CPT Pharmacometrics Syst Pharmacol. 2022;11:1283-1293. doi:10.1002/psp4.12829</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span></span>
<span>    path.nonmem <span class="op">=</span> <span class="st">"/opt/NONMEM/nm75/run/nmfe75"</span>, <span class="co">## path to NONMEM executable</span></span>
<span>    dir.sims<span class="op">=</span><span class="st">"simtmp-forest"</span>, <span class="co">## where to store temporary simulation results</span></span>
<span>    dir.res<span class="op">=</span><span class="st">"simres-forest"</span>,   <span class="co">## where to store final simulation results</span></span>
<span>    as.fun<span class="op">=</span><span class="st">"data.table"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A model is selected.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file.mod</span> <span class="op">&lt;-</span> <span class="st">"NMsim-forest-models/xgxr134.mod"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generation-of-simulation-input-data">Generation of simulation input data<a class="anchor" aria-label="anchor" href="#generation-of-simulation-input-data"></a>
</h2>
<p>The simulation data set has to match the model in compartment
numbers, and it must contain all variables needed to run the NONMEM
model. We simulate daily dosing of 30 mg.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMcreateDoses.html">NMcreateDoses</a></span><span class="op">(</span>TIME<span class="op">=</span><span class="fl">0</span>,AMT<span class="op">=</span><span class="fl">30</span>,addl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADDL<span class="op">=</span><span class="fl">100</span>,II<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,col.id<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/expandCovs.html">NMsim::expandCovs()</a></code> can be used to construct a set of
simulations needed to derive a forest plot. It varies one covariate at a
time, keeping all other covariates at their reference value. It can
derive references and quantiles from a data set.</p>
<p>For reference values we use median in the observed population for
continuous covariates and manually select “Female” as the reference for
sex.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## reading output and input tables from estimation. Used to determine</span></span>
<span><span class="co">## reference values and quantiles.</span></span>
<span><span class="va">data.ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMscanData.html" class="external-link">NMscanData</a></span><span class="op">(</span><span class="va">file.mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Model:  xgxr134 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Used tables, contents shown as used/total:</span></span>
<span><span class="co">##                   file     rows columns   IDs</span></span>
<span><span class="co">##        xgxr134_res.txt  731/731   12/12 90/90</span></span>
<span><span class="co">##       xgxr134_etas.txt  731/731     5/5 90/90</span></span>
<span><span class="co">##  xgxr2covs.rds (input) 731/1502   24/26 90/90</span></span>
<span><span class="co">##               (result)      731    41+2    90</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Input and output data merged by: ROW </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Distribution of rows on event types in returned data:</span></span>
<span><span class="co">##  EVID CMT output result</span></span>
<span><span class="co">##     0   2    641    641</span></span>
<span><span class="co">##     1   1     90     90</span></span>
<span><span class="co">##   All All    731    731</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandCovs.html">expandCovs</a></span><span class="op">(</span></span>
<span>    AGE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ref<span class="op">=</span><span class="va">median</span>,quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">25</span>,<span class="fl">75</span>,<span class="fl">90</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>,label<span class="op">=</span><span class="st">"Age (years)"</span><span class="op">)</span>,</span>
<span>    <span class="co">## notice, values OR quantiles can be provided</span></span>
<span>    WEIGHTB<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ref<span class="op">=</span><span class="va">median</span>, quantiles<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">25</span>,<span class="fl">75</span>,<span class="fl">90</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, label<span class="op">=</span><span class="st">"Bodyweigt (kg)"</span><span class="op">)</span>,</span>
<span>    MALEN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ref<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Female<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Male<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, label<span class="op">=</span><span class="st">"Sex"</span><span class="op">)</span>,</span>
<span>    data<span class="op">=</span><span class="va">data.ref</span>,</span>
<span>    as.fun<span class="op">=</span><span class="st">"data.table"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covs</span><span class="op">[</span>,<span class="va">ID</span><span class="op">:=</span><span class="va">.GRP</span>,by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">type</span>,<span class="va">covvar</span>,<span class="va">covval</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">dt.dos</span> <span class="op">&lt;-</span> <span class="va">covs</span><span class="op">[</span>,<span class="va">doses</span><span class="op">[</span><span class="op">]</span>,by<span class="op">=</span><span class="va">covs</span><span class="op">]</span></span></code></pre></div>
<p>We sample every 15 minutes for one day in steady-state.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## add a sampling scheme</span></span>
<span><span class="va">time.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>TIME<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">24</span>,<span class="fl">.25</span><span class="op">)</span><span class="op">+</span><span class="fl">30</span><span class="op">*</span><span class="fl">24</span>,period<span class="op">=</span><span class="st">"Steady-State"</span><span class="op">)</span></span>
<span><span class="va">dt.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addEVID2.html">addEVID2</a></span><span class="op">(</span><span class="va">dt.dos</span>,TIME<span class="op">=</span><span class="va">time.sim</span>,CMT<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampleParsSimpar.html">sampleParsSimpar</a></span><span class="op">(</span>file.mod<span class="op">=</span><span class="va">file.mod</span>,nsim<span class="op">=</span><span class="fl">500</span>,seed.R<span class="op">=</span><span class="fl">6789</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## library(devtools)</span></span>
<span><span class="co">## load_all("~/wdirs/NMsim")</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="cn">F</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">simres.forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMsim.html">NMsim</a></span><span class="op">(</span><span class="va">file.mod</span> <span class="co"># path to NONMEM model</span></span>
<span>                          ,data<span class="op">=</span><span class="va">dt.sim</span>, <span class="co"># simulation dataset</span></span>
<span>                          ,name.sim<span class="op">=</span><span class="st">"forest_simpar"</span> <span class="co"># output name suffix</span></span>
<span>                           <span class="co">##,method.sim=NMsim_VarCov # sampling method</span></span>
<span>                          ,method.sim<span class="op">=</span><span class="va">NMsim_VarCov</span> <span class="co"># sampling method</span></span>
<span>                          ,ext<span class="op">=</span><span class="va">ext</span></span>
<span>                          ,typical<span class="op">=</span><span class="cn">TRUE</span> <span class="co"># FALSE to include BSV</span></span>
<span>                          ,table.vars<span class="op">=</span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/cc.html" class="external-link">cc</a></span><span class="op">(</span><span class="va">PRED</span>,<span class="va">IPRED</span><span class="op">)</span> <span class="co"># output table variables</span></span>
<span>                          ,method.update.inits<span class="op">=</span><span class="st">"nmsim"</span> <span class="co"># update parameters from ext</span></span>
<span>                           <span class="co">## ,nsims=2 # number of simulations</span></span>
<span>                           <span class="co">## ,subproblems=10 # number of simulations</span></span>
<span>                          ,seed.R<span class="op">=</span><span class="fl">342</span> <span class="co"># seed for reproducibility</span></span>
<span>                          ,sge<span class="op">=</span><span class="cn">TRUE</span> <span class="co"># TRUE if submitting to a cluster</span></span>
<span>                          ,nc<span class="op">=</span><span class="fl">1</span></span>
<span>                           <span class="co">## ,reuse.results=TRUE # TRUE to load existing results</span></span>
<span>                          ,quiet <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">## FALSE to view all output messages</span></span>
<span>                          ,reuse.results<span class="op">=</span><span class="cn">TRUE</span></span>
<span>                           <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">simres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMreadSim.html">NMreadSim</a></span><span class="op">(</span><span class="va">simres.forest</span>,wait<span class="op">=</span><span class="cn">T</span>,rm.tmp<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMreadSim.html">NMreadSim</a></span><span class="op">(</span><span class="st">"simres-forest/xgxr134_forest_simpar_MetaData.rds"</span><span class="op">)</span></span>
<span><span class="co">## source("~/wdirs/NMpub/ACOP2024/forest/forest_summarize.R")</span></span>
<span></span>
<span><span class="co">########## postprocess</span></span>
<span><span class="co">### Exposure metrics</span></span>
<span><span class="va">funs.exposure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Cmax"</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">PRED</span><span class="op">)</span></span>
<span>   ,<span class="st">"AUC"</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/NMcalc/man/trapez.html" class="external-link">trapez</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">TIME</span>,<span class="va">x</span><span class="op">$</span><span class="va">PRED</span><span class="op">)</span></span>
<span>    <span class="co">## ,"Concentration at 4 hours"=function(x) x$value[x$TAPD==4]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">sum.uncertain</span> <span class="op">&lt;-</span> <span class="fu">NMsim</span><span class="fu">:::</span><span class="fu">summarizeCovvar</span><span class="op">(</span><span class="va">simres</span>,</span>
<span>                                         funs.exposure <span class="op">=</span> <span class="va">funs.exposure</span>,</span>
<span>                                         by<span class="op">=</span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/cc.html" class="external-link">cc</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span>,</span>
<span>                                         cover.ci<span class="op">=</span><span class="fl">.95</span></span>
<span>                                         <span class="op">)</span></span></code></pre></div>
<p>Plotting using <code>coveffectsplot</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum.uncertain.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">sum.uncertain</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">sum.uncertain.plot</span>,</span>
<span>         <span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/cc.html" class="external-link">cc</a></span><span class="op">(</span><span class="va">covvalf</span>,<span class="va">predmm</span>,<span class="va">predml</span>,<span class="va">predmu</span>,<span class="va">metric.var</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/cc.html" class="external-link">cc</a></span><span class="op">(</span><span class="va">label</span>,<span class="va">mid</span>,<span class="va">lower</span>,<span class="va">upper</span>,<span class="va">paramname</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="va">sum.uncertain.plot</span><span class="op">[</span>,<span class="va">MEANVAL</span><span class="op">:=</span><span class="va">mid</span><span class="op">]</span></span>
<span><span class="va">nsig</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sum.uncertain.plot</span><span class="op">[</span>,<span class="va">LABEL</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s [%s - %s]"</span>,<span class="fu"><a href="https://rdrr.io/pkg/NMcalc/man/signif2.html" class="external-link">signif2</a></span><span class="op">(</span><span class="va">mid</span>,<span class="va">nsig</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/NMcalc/man/signif2.html" class="external-link">signif2</a></span><span class="op">(</span><span class="va">lower</span>,<span class="va">nsig</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/NMcalc/man/signif2.html" class="external-link">signif2</a></span><span class="op">(</span><span class="va">upper</span>,<span class="va">nsig</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sum.uncertain.plot</span><span class="op">[</span>,<span class="va">covname</span><span class="op">:=</span><span class="va">covlabel</span><span class="op">]</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">escape_newline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\\\n"</span>, <span class="st">"\\\n"</span>, <span class="va">s</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">### where is this supposed to come from?</span></span>
<span><span class="va">label_value</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">...</span> <span class="op">)</span><span class="va">x</span></span>
<span></span>
<span><span class="va">textsize</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">forest1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://smouksassi.github.io/coveffectsplot/reference/forest_plot.html" class="external-link">forest_plot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sum.uncertain.plot</span>,</span>
<span>    facet_formula <span class="op">=</span> <span class="st">"covlabel ~ paramname"</span>, </span>
<span>    facet_scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>    facet_space <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>    <span class="co">## facet_labeller = "label_value",</span></span>
<span>    xy_facet_text_bold <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    plot_table_ratio <span class="op">=</span> <span class="fl">1.7</span>, </span>
<span>    table_text_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    <span class="co">## label_wrap_width = 16L,</span></span>
<span>    x_label_text_size <span class="op">=</span> <span class="va">textsize</span>,</span>
<span>    y_label_text_size <span class="op">=</span> <span class="va">textsize</span>, </span>
<span>    <span class="co">## table_title_size = 16L,</span></span>
<span>    x_facet_text_size <span class="op">=</span> <span class="va">textsize</span>, </span>
<span>    y_facet_text_size <span class="op">=</span> <span class="va">textsize</span>,</span>
<span>    base_size<span class="op">=</span><span class="va">textsize</span>,</span>
<span>    <span class="co">## interval_size=.65, ## geom_pointerinterval size</span></span>
<span>    strip_placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>    table_position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>    legend_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pointinterval"</span>, <span class="st">"ref"</span>, <span class="st">"area"</span><span class="op">)</span>,</span>
<span>    x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">1.5</span><span class="op">)</span>,</span>
<span>    <span class="co">## interval_size=1.1,</span></span>
<span>    <span class="co">## interval_fatten = 5L,</span></span>
<span>    <span class="co">## interval_linewidth = 2,</span></span>
<span>    ref_legend_text <span class="op">=</span> <span class="fu">escape_newline</span><span class="op">(</span><span class="st">"Reference (vertical line)\\nClinically relevant limits 0.8-1.25 (colored area)"</span><span class="op">)</span>,</span>
<span>    area_legend_text <span class="op">=</span> <span class="fu">escape_newline</span><span class="op">(</span><span class="st">"Reference (vertical line)\\nClinically relevant limits 0.8-1.25 (colored area)"</span><span class="op">)</span>,</span>
<span>    facet_switch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span><span class="op">)</span>,</span>
<span>    legend_position<span class="op">=</span><span class="st">"bottom"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as</span></span>
<span><span class="co">## of ggplot2 3.3.4.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">coveffectsplot</span> package.</span></span>
<span><span class="co">##   Please report the issue at</span></span>
<span><span class="co">##   <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/smouksassi/coveffectsplot/issues&gt;</span>.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="NMsim-forest_files/figure-html/unnamed-chunk-7-1.png" width="960"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>



  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
