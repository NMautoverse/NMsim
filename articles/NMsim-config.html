<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="NMsim">
<title>NMsim Configuration • NMsim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="NMsim Configuration">
<meta property="og:description" content="NMsim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/NMsim-basics.html">Simulation of new subjects</a>
    <a class="dropdown-item" href="../articles/NMsim-VPC.html">Simulations for VPCs</a>
    <a class="dropdown-item" href="../articles/NMsim-config.html">NMsim Configuration</a>
    <a class="dropdown-item" href="../articles/NMsim-known.html">Simulate known subjects</a>
    <a class="dropdown-item" href="../articles/NMsim-TypSubj.html">Simulate typical subjects</a>
    <a class="dropdown-item" href="../articles/NMsim-ParamUncertain.html">Simulations with parameter uncertainty</a>
    <a class="dropdown-item" href="../articles/NMsim-DataCreate.html">Creation of Simulation Data Sets</a>
    <a class="dropdown-item" href="../articles/NMsim-ResidVar.html">Simulation with residual variability</a>
    <a class="dropdown-item" href="../articles/NMsim-varyPars.html">Varying parameter values</a>
    <a class="dropdown-item" href="../articles/NMsim-ReuseSimSubjects.html">Reuse simulated subjects</a>
    <a class="dropdown-item" href="../articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/philipdelff/NMsim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/philipdelff/NMsim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>NMsim Configuration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/philipdelff/NMsim/blob/HEAD/vignettes/NMsim-config.Rmd" class="external-link"><code>vignettes/NMsim-config.Rmd</code></a></small>
      <div class="d-none name"><code>NMsim-config.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<p>This vignettes aims at enabling you to</p>
<ul>
<li><p>Configure <code>NMsim</code> to use <code>PSN</code> or methods
provided by <code>NMsim</code> to update Nonmem control stream initial
values and to run Nonmem</p></li>
<li><p>Understand pros and cons of using <code>PSN</code> vs. methods
provided by <code>NMsim</code>.</p></li>
</ul>
<p>NMsim relies on Nonmem for running simulations. If your system does
not meet the requirements described in this document, it does not mean
that NMsim can’t work. It can still put together your Nonmem simulations
and make everything ready for Nonmem to be executed. Once you have run
Nonmem, you can then use <code><a href="https://philipdelff.github.io/NMdata/reference/NMscanData.html" class="external-link">NMdata::NMscanData()</a></code> to collect
the results.</p>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<p>Currently, NMsim only fully supports systems that run Nonmem on
linux. Windows support is experimental.</p>
<p>Notice, the important thing is which system is running Nonmem, not
what system is running R. So if you run R on a windows system and can
run Nonmem through an ssh tunnel, NMsim should still be able to work. If
you run Nonmem on Windows and would like to get NMsim to work, reach out
and we will figure it out.</p>
<p>NMsim functions and their arguments often refer to input control
streams by <code>.mod</code>. It should work independently of the file
name extension of the input control streams. The estimate files
(<code>.ext</code> and if known subjects simulated <code>.phi</code>)
are currently expected to carry the same file name but with those file
name extension.</p>
</div>
<div class="section level2">
<h2 id="configuration-of-nmsim">Configuration of NMsim<a class="anchor" aria-label="anchor" href="#configuration-of-nmsim"></a>
</h2>
<p>Below this section, some background discussion is provided to
understand which methods to choose. No matter what you prefer to use,
the best is to set up NMsim to be able to use both Nonmem and (if
available) PSN. Then you have the flexibility to switch between methods
as preferred.</p>
<div class="section level3">
<h3 id="specify-the-nonmem-paths">Specify the Nonmem paths<a class="anchor" aria-label="anchor" href="#specify-the-nonmem-paths"></a>
</h3>
<p>For NMsim to run Nonmem, it needs to know where to find the Nonmem
executable.</p>
<p>The easiest way to do configure this is through NMdata’s
configuration function. Say you want to run Nonmem with
<code>/opt/NONMEM/nm75/run/nmfe</code>, insert this after loading
<code>NMdata</code> in the beginning of your script</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://philipdelff.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>path.nonmem<span class="op">=</span><span class="st">"/opt/NONMEM/nm75/run/nmfe75"</span><span class="op">)</span></span></code></pre></div>
<p>On Windows, the executable has a <code>.bat</code> extension. The
path could look be</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://philipdelff.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>path.nonmem <span class="op">=</span><span class="st">"C:/nm75g64/run/nmfe75.bat"</span><span class="op">)</span></span></code></pre></div>
<p>If you normally use PSN as your Nonmem interface, and you therefore
do not know where Nonmem is installed, you can check this using PSN. The
following command should give you the Nonmem installation paths that PSN
is configured with. However, you likely still need to add the last piece
of the path from the installation directory to the nonmem binary.</p>
<pre><code><span><span class="va">psn</span> <span class="op">-</span><span class="va">nm_versions</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="specify-the-psn-installation-path">Specify the PSN installation path<a class="anchor" aria-label="anchor" href="#specify-the-psn-installation-path"></a>
</h3>
<p>If PSN is available, and you can run <code>execute</code> and
<code>update_inits</code> in a terminal, you don’t need to configure
anything. If you have PSN installed, but you have to provide the paths
to those two executables when running them (something like
<code>/opt/PSN/execute run1.mod</code>), you will have to tell NMsim
where to find them. In this case, the easiest is loading NMdata and then
running:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://philipdelff.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>dir.psn<span class="op">=</span><span class="st">"/opt/PSN"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="psn-or-not">PSN or not?<a class="anchor" aria-label="anchor" href="#psn-or-not"></a>
</h2>
<div class="section level3">
<h3 id="psn-or-not-for-nonmem-execution">PSN or not for Nonmem execution<a class="anchor" aria-label="anchor" href="#psn-or-not-for-nonmem-execution"></a>
</h3>
<p>NMsim can call Nonmem using PSN’s <code>execute</code> or through
similar functionality included in NMsim. We will refer to those methods
by the way they are referred to in the <code><a href="../reference/NMsim.html">NMsim()</a></code> function
argument that controls which one is used,
i.e. <code>method.execute="psn"</code> and
<code>method.execute="nmsim"</code>.</p>
<p>For simulations, <code>method.execute="psn"</code> does not provide
advantages over <code>method.execute="nmsim"</code>. In contrast, there
are simulation types that will only work with
<code>method.execute="nmsim"</code>. You need to tell NMsim where to
find Nonmem (by setting <code>path.nonmem</code>) for this to work.</p>
<p>Nonmem execution with <code><a href="../reference/NMexec.html">NMexec()</a></code> (typically, for
estimation and not simulation) is a slightly different discussion. See
<code><a href="../reference/NMexec.html">?NMexec</a></code> for that.</p>
</div>
<div class="section level3">
<h3 id="psn-or-not-for-updating-initial-values">PSN or not for updating initial values<a class="anchor" aria-label="anchor" href="#psn-or-not-for-updating-initial-values"></a>
</h3>
<p>NMsim needs to update initial values using the model estimate prior
to running a simulation. PSN provides the <code>update_inits</code>
function to do this, and if available, this is the default method in
NMsim. Again, we refer to this by the argument name,
<code>method.update.inits="psn"</code>.</p>
<p>NMsim also provides a similar functionality internally, referred to
as <code>method.update.inits="NMsim"</code>. This will be used if PSN is
not found - or if you ask for it.</p>
<p><code>method.update.inits="psn"</code> has two advantages over the
NMsim-provided method. It is widely used, and it keeps comments in
affected control stream sections (<code>$THETA</code>,
<code>$OMEGA</code>, <code>$SIGMA</code>).
<code>method.update.inits="nmsim"</code> will drop all comments in
affected sections. I have in the past seen issues with some methods to
update <code>$OMEGA</code> sections with off-diagonal elements
(<code>BLOCK</code>). <code>method.update.inits="nmsim"</code> takes a
very simple approach. Reading the <code>OMEGA</code> matrix from the
<code>.ext</code> file, this is not relying on interpreting Nonmem code
at all. The support of systems without <code>PSN</code> would be the
main reason one would choose <code>method.update.inits="nmsim"</code>
over <code>method.update.inits="psn"</code>.</p>
<p>In order to make use of <code>method.update.inits="psn"</code>, you
need to make sure NMsim can find PSN.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
